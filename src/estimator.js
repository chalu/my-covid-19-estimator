import{chain,whatIs}from"on-covid-19";const asInt=e=>parseInt(e,10),getTimeToElapseInDays=(e,t)=>{let a=e;return"WEEKS"===t.toUpperCase()&&(a=7*e),"MONTHS"===t.toUpperCase()&&(a=30*e),a},calcDollarsInFlight=(e,t)=>{const{timeToElapse:a,periodType:s,region:i}=e,{avgDailyIncomeInUSD:n,avgDailyIncomePopulation:c}=i,r=getTimeToElapseInDays(a,s);return asInt(t*c*n/r)},estimateCurrentlyInfected=({data:e,impact:t,severeImpact:a})=>{const{reportedCases:s}=e;return t.currentlyInfected=asInt(10*s),a.currentlyInfected=asInt(50*s),{data:e,impact:t,severeImpact:a}},estimateProjectedInfections=({data:e,impact:t,severeImpact:a})=>{const{timeToElapse:s,periodType:i}=e,{currentlyInfected:n}=t,{currentlyInfected:c}=a,r=getTimeToElapseInDays(s,i),m=asInt(r/3);return t.infectionsByRequestedTime=asInt(n*2**m),a.infectionsByRequestedTime=asInt(c*2**m),{data:e,impact:t,severeImpact:a}},estimateSevereCases=({data:e,impact:t,severeImpact:a})=>{const{infectionsByRequestedTime:s}=t,{infectionsByRequestedTime:i}=a;return t.severeCasesByRequestedTime=asInt(whatIs("15%").of(s)),a.severeCasesByRequestedTime=asInt(whatIs("15%").of(i)),{data:e,impact:t,severeImpact:a}},estimateBedSpaceAvailability=({data:e,impact:t,severeImpact:a})=>{const{totalHospitalBeds:s}=e,{severeCasesByRequestedTime:i}=t,{severeCasesByRequestedTime:n}=a,c=whatIs("35%").of(s);return t.hospitalBedsByRequestedTime=asInt(c-i),a.hospitalBedsByRequestedTime=asInt(c-n),{data:e,impact:t,severeImpact:a}},estimateCasesForICU=({data:e,impact:t,severeImpact:a})=>{const{infectionsByRequestedTime:s}=t,{infectionsByRequestedTime:i}=a;return t.casesForICUByRequestedTime=asInt(whatIs("5%").of(s)),a.casesForICUByRequestedTime=asInt(whatIs("5%").of(i)),{data:e,impact:t,severeImpact:a}},estimateCasesForVentilators=({data:e,impact:t,severeImpact:a})=>{const{infectionsByRequestedTime:s}=t,{infectionsByRequestedTime:i}=a;return t.casesForVentilatorsByRequestedTime=asInt(whatIs("2%").of(s)),a.casesForVentilatorsByRequestedTime=asInt(whatIs("2%").of(i)),{data:e,impact:t,severeImpact:a}},estimateDollarsInFlight=({data:e,impact:t,severeImpact:a})=>{const{infectionsByRequestedTime:s}=t,{infectionsByRequestedTime:i}=a;return t.dollarsInFlight=calcDollarsInFlight(e,s),a.dollarsInFlight=calcDollarsInFlight(e,i),{data:e,impact:t,severeImpact:a}},covid19ImpactEstimator=async e=>chain(estimateCurrentlyInfected,estimateProjectedInfections,estimateSevereCases,estimateBedSpaceAvailability,estimateCasesForICU,estimateCasesForVentilators,estimateDollarsInFlight)({data:e,impact:{},severeImpact:{}});module.exports=covid19ImpactEstimator;